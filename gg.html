<!-- GitHub-Tablet-Editor-v25.2-2025-08-28 08:29 AM -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>GitHub Tablet Editor ‚Äî v25.2</title>
  <style>
    :root {
      --gap: 8px; --pad: 12px; --border: 1px solid #d0d7de; --radius: 8px;
      --bg: #f6f8fa; --fg: #24292f; --muted: #57606a; --ok: #1a7f37; --err: #d1242f;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;font-size:14px}
    .wrap{height:100vh;display:flex;flex-direction:column;gap:var(--gap);padding:var(--pad);overflow:hidden}
    .card{background:#fff;border:var(--border);border-radius:var(--radius);padding:var(--pad)}
    .row{display:flex;flex-wrap:wrap;gap:var(--gap);align-items:center}
    label{font-size:11px;color:var(--muted);display:block;margin-bottom:3px;font-weight:500}
    input[type=text],input[type=search],select{padding:8px 10px;border:var(--border);border-radius:6px;background:#fff;font-size:16px;min-width:0;flex:1}
    button{padding:8px 12px;border:var(--border);border-radius:6px;background:#f6f8fa;font-weight:500;cursor:pointer;font-size:13px;white-space:nowrap;min-height:36px; display:inline-flex; align-items:center; justify-content:center; gap: 4px;}
    button:hover:not(:disabled){border-color:#a0a5ac; background-color: #f3f4f6;}
    button:disabled{cursor:not-allowed; opacity:0.6;}
    button.primary{background:var(--ok);color:#fff;border-color:var(--ok)}
    button.primary:hover:not(:disabled){background:#176f32;}
    .icon-btn{padding:6px;min-width:36px; font-size: 16px;}
    .upload-btn{position:relative;overflow:hidden}
    .upload-btn input[type=file]{position:absolute;left:-9999px;opacity:0}
    .omni-wrap{position:relative;flex:1;min-width:0}
    .omni-list{position:absolute;top:100%;left:0;right:0;z-index:50;background:#fff;border:var(--border);border-radius:6px;margin-top:4px;max-height:40vh;overflow:auto;display:none}
    .omni-item{padding:8px 10px;border-bottom:var(--border);font-family:var(--mono);font-size:11px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer}
    .omni-item:last-child{border-bottom:none}
    .omni-item:hover{background:#f0f3f6}

    /* Main Layout */
    .content-container{display:flex;flex-direction:column;gap:var(--gap);flex:1;min-height:0; overflow-y: auto;}
    .pane{display:flex;flex-direction:column;min-height:0;}
    .pane.collapsed{flex-grow:0; flex-shrink:0;}
    .pane-header{display:flex;align-items:center;gap:var(--gap);margin-bottom:4px}
    .pane-filename{font-size:13px;font-weight:600;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:8px 0;}
    #filenameInput{padding:6px 10px;font-size:16px;font-weight:600;min-height:36px;}
    .textarea-wrap{position:relative;display:flex;flex-direction:column;min-height:0;flex:1;height:100%;}
    textarea{width:100%;height:100%;min-height: calc(9 * 1.4em + 20px); border:var(--border);border-radius:6px;font-family:var(--mono);font-size:10pt;line-height:1.4;resize:vertical;overflow-y:scroll;padding:10px;padding-top:40px;}
    .pane.collapsed .textarea-wrap, .pane.collapsed .pane-header{display:none}
    .pane-buttons{display:flex;gap:var(--gap);margin-bottom: var(--gap);}

    /* Toolbar for Textareas */
    .textarea-toolbar{position:absolute;top:0;left:0;right:0;z-index:10;background:#f0f3f6;padding:4px;display:flex;gap:var(--gap);border-bottom:var(--border);border-radius:6px 6px 0 0;align-items:center;}
    .toolbar-group{display:flex;gap:4px;align-items:center;}
    .toolbar-find{flex:1;}
    .toolbar-btn{padding:4px 8px;font-size:11px;min-height:0;}
    .toolbar-find input{font-size:12px;padding:4px 6px;width:100%;}
    .find-nav button{padding:4px;min-height:0;font-size:10px;}
    .find-results{font-size:11px;color:var(--muted);padding:0 6px;min-width:40px;text-align:center;}
    #fontSizeSelectOriginal, #fontSizeSelectUpdated {font-size:12px;padding:3px 4px;min-height:0;height:26px;}

    /* Modals */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.35);padding:12px;z-index:9990}
    .modal.open{display:flex}
    .panel{background:#fff;border:var(--border);border-radius:var(--radius);overflow:hidden;padding:16px;display:flex;flex-direction:column;max-height:90vh;width:90vw;max-width:1000px}
    .panel header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-shrink:0}
    .panel header h2{margin:0;font-size:16px;font-weight:600}
    .panel header .header-actions{display:flex;gap:8px;}
    .panel header button{border:none;background:transparent;font-weight:700;font-size:18px;cursor:pointer;padding:4px;min-width:32px}
    
    /* Diff Modal */
    #diffPanel{width:95vw;max-width:1400px;height:90vh; background:#0d1117; color:#e6edf3;}
    #diffPanel header{border-bottom:1px solid #30363d;}
    #diffPanel header h2{color:#e6edf3;}
    #diffPanel header button{color:#e6edf3; background: #21262d; border-color: #30363d;}
    .diff-grid{display:grid;grid-template-columns:1fr 1fr;gap:var(--gap);overflow:auto;flex-grow:1;}
    .diff-col{display:flex;flex-direction:column;}
    .diff-col-header{font-weight:600;padding:4px 8px;border-bottom:1px solid #30363d;margin-bottom:4px;position:sticky;top:0;background:#0d1117;}
    .diff-content{white-space:pre-wrap;word-break:break-all;font-family:var(--mono);padding:8px;border-radius:4px;font-size:12px;}
    .diff-content.del{background-color:rgba(248,81,73,0.15);color:#ff7b72;}
    .diff-content.add{background-color:rgba(46,160,67,0.15);color:#56d364;}

    #previewFrame{width:100%;height:100%;border:none;flex-grow:1}
    .status-ok{color:var(--ok)} .status-err{color:var(--err)}
    .status-ok a{color:var(--ok);text-decoration:underline}
    .launch-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:8px}
    .launch-btn{background:var(--ok);color:#fff;border-color:var(--ok);text-decoration:none}
    .launch-btn:hover{background:#176f32;}
    .toast-wrap{position:fixed;left:50%;bottom:16px;transform:translateX(-50%);display:grid;gap:6px;z-index:9999;max-width:90vw}
    .toast{background:#111827;color:#fff;padding:8px 12px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.2);font-size:13px;text-align:center}
    .warn{background:#c81e1e}
    
    #repoSettingsModal .panel{max-width:500px;}
    #repoSettingsModal .row{display:flex;flex-direction:column;align-items:stretch;gap:var(--gap);}
    #commitInfo { font-family: var(--mono); font-size: 12px; color: var(--muted); margin-bottom: 8px; padding-bottom: 8px; border-bottom: var(--border); }
    #commitSteps a { color: #0969da; text-decoration: none; }
    #commitSteps a:hover { text-decoration: underline; }
    .footer{font-size:10px;color:var(--muted);text-align:center;padding-top:var(--gap);}

    /* Responsive Desktop Layout */
    @media (min-width: 768px) {
      .content-container {
        flex-direction: row;
      }
      .pane {
        flex: 1;
      }
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="row">
      <div class="omni-wrap">
        <input type="search" id="searchInput" placeholder="Search files‚Ä¶" autocomplete="off">
        <div id="omniList" class="omni-list" role="listbox" aria-label="File results"></div>
      </div>
      <button id="repoSettingsBtn" title="Repository Settings" type="button" class="icon-btn">‚öôÔ∏è</button>
    </div>
  </div>
  <div class="content-container card">
    <!-- Original -->
    <div class="pane" id="paneOriginal">
      <div class="pane-buttons">
        <button id="copyOriginalBtn" class="icon-btn" title="Copy Content" type="button">üìã</button>
        <button id="previewOriginalBtn" class="icon-btn" title="Preview" type="button">üëÅÔ∏è</button>
        <button id="reloadOriginalBtn" class="icon-btn" title="Reload" type="button">üîÑ</button>
      </div>
      <div class="pane-header">
        <div class="pane-filename" id="originalTitle">(no file selected)</div>
      </div>
      <div class="textarea-wrap">
        <div class="textarea-toolbar">
            <div class="toolbar-group toolbar-find">
                <input type="search" id="findInputOriginal" placeholder="Find‚Ä¶">
                <button id="findBtnOriginal" class="toolbar-btn">‚Üí</button>
                <span id="findResultsOriginal" class="find-results"></span>
                <div class="find-nav">
                    <button id="findPrevOriginal" class="toolbar-btn">‚Üë</button>
                    <button id="findNextOriginal" class="toolbar-btn">‚Üì</button>
                </div>
            </div>
            <div class="toolbar-group">
                <select id="fontSizeSelectOriginal" class="toolbar-btn">
                    <option value="9">9pt</option><option value="10" selected>10pt</option><option value="11">11pt</option><option value="12">12pt</option><option value="14">14pt</option><option value="16">16pt</option><option value="18">18pt</option><option value="24">24pt</option><option value="28">28pt</option>
                </select>
                <button class="toolbar-btn" id="scrollTopOriginal" title="Scroll to Top">‚¨ÜÔ∏è</button>
            </div>
        </div>
        <textarea id="originalBox" rows="9" readonly></textarea>
      </div>
    </div>
    <!-- Updated -->
    <div class="pane" id="paneUpdated">
      <div class="pane-buttons">
        <button class="upload-btn icon-btn" id="uploadBtn" type="button" title="Upload file">üìÅ<input type="file" id="fileInput" accept="*/*"></button>
        <button id="pasteBtn" class="icon-btn" title="Paste" type="button">üìÑ</button>
        <button id="diffBtn" class="icon-btn" title="Diff" type="button">?</button>
        <button id="commitBtn" class="primary icon-btn" title="Commit" type="button">‚úì</button>
      </div>
       <div class="pane-header">
        <input type="text" id="filenameInput" class="pane-filename" placeholder="filename">
      </div>
      <div class="textarea-wrap">
         <div class="textarea-toolbar">
            <div class="toolbar-group toolbar-find">
                <input type="search" id="findInputUpdated" placeholder="Find‚Ä¶">
                <button id="findBtnUpdated" class="toolbar-btn">‚Üí</button>
                <span id="findResultsUpdated" class="find-results"></span>
                <div class="find-nav">
                    <button id="findPrevUpdated" class="toolbar-btn">‚Üë</button>
                    <button id="findNextUpdated" class="toolbar-btn">‚Üì</button>
                </div>
            </div>
            <div class="toolbar-group">
                <select id="fontSizeSelectUpdated" class="toolbar-btn">
                    <option value="9">9pt</option><option value="10" selected>10pt</option><option value="11">11pt</option><option value="12">12pt</option><option value="14">14pt</option><option value="16">16pt</option><option value="18">18pt</option><option value="24">24pt</option><option value="28">28pt</option>
                </select>
                <button class="toolbar-btn" id="scrollTopUpdated" title="Scroll to Top">‚¨ÜÔ∏è</button>
            </div>
        </div>
        <textarea id="updatedBox" rows="9"></textarea>
      </div>
    </div>
  </div>
  <div class="footer" id="masterFooter"></div>
</div>

<!-- Modals -->
<div id="repoSettingsModal" class="modal" role="dialog" aria-modal="true" aria-label="Repository Settings"><div class="panel"><header><h2>Repository Settings</h2><button id="repoSettingsClose" title="Close" type="button">‚úï</button></header><div class="row"><label for="userInput">User / Organization</label><input type="text" id="userInput"><label for="repoSelect">Repository</label><select id="repoSelect" disabled><option>Enter user first</option></select></div></div></div>
<div id="commitModal" class="modal" role="dialog" aria-modal="true" aria-label="Commit status"><div class="panel"><header><h2>Commit Status</h2><button id="commitClose" title="Close" type="button">‚úï</button></header><div id="commitInfo"></div><ol id="commitSteps"></ol><div id="commitActions" style="margin-top: 16px;"></div></div></div>
<div id="diffModal" class="modal" role="dialog" aria-modal="true" aria-label="Diff view"><div class="panel" id="diffPanel"><header><h2>Diff (Changes Only)</h2><div class="header-actions"><button id="copyDiffBtn" type="button">Copy Diff</button><button id="diffClose" title="Close" type="button">‚úï</button></div></header><div id="diffOutput" class="diff-grid"></div></div></div>
<div id="previewModal" class="modal" role="dialog" aria-modal="true" aria-label="Preview"><div class="panel" style="height:90vh;width:95vw;"><header><h2>Preview</h2><button id="previewClose" title="Close" type="button">‚úï</button></header><iframe id="previewFrame" sandbox="allow-scripts allow-same-origin"></iframe></div></div>
<div id="pasteModal" class="modal" role="dialog" aria-modal="true" aria-label="Paste content"><div class="panel"><header><h2>Paste Content</h2><button id="pasteClose" title="Close" type="button">‚úï</button></header><div class="muted" style="margin-bottom:8px">Clipboard read not permitted. Paste here and confirm.</div><textarea id="pasteArea" style="width:100%;height:40vh;min-height:200px;font-size:16px;"></textarea><div style="margin-top:10px;text-align:right;"><button id="pasteConfirm" class="primary" type="button">Use This Content</button></div></div></div>
<div class="toast-wrap" id="toasts" aria-live="polite" aria-atomic="true"></div>

<script>
(() => {
  // --- State and Constants ---
  const APP_VERSION = "v25.2-2025-08-28 08:29 AM";
  const DEFAULT_USER = "acmeproducts";
  const DEFAULT_REPO_HINT = "stuff";
  let GITHUB_TOKEN = null;
  let currentUser = DEFAULT_USER;
  let currentRepo = null;
  let repoDefaultBranch = 'main';
  let treeCache = [];
  let currentPath = null;
  let currentSha = null;
  const findState = {
      original: { matches: [], currentIndex: -1, query: '' },
      updated: { matches: [], currentIndex: -1, query: '' }
  };

  // --- Element Cache ---
  const $ = (id) => document.getElementById(id);
  const elements = {
    userInput: $('userInput'), repoSelect: $('repoSelect'), searchInput: $('searchInput'), omniList: $('omniList'),
    repoSettingsBtn: $('repoSettingsBtn'), repoSettingsModal: $('repoSettingsModal'), repoSettingsClose: $('repoSettingsClose'),
    paneOriginal: $('paneOriginal'), originalTitle: $('originalTitle'), originalBox: $('originalBox'),
    copyOriginalBtn: $('copyOriginalBtn'), previewOriginalBtn: $('previewOriginalBtn'), reloadOriginalBtn: $('reloadOriginalBtn'),
    fontSizeSelectOriginal: $('fontSizeSelectOriginal'), findInputOriginal: $('findInputOriginal'), findBtnOriginal: $('findBtnOriginal'), findResultsOriginal: $('findResultsOriginal'), findPrevOriginal: $('findPrevOriginal'), findNextOriginal: $('findNextOriginal'),
    scrollTopOriginal: $('scrollTopOriginal'),
    paneUpdated: $('paneUpdated'), updatedBox: $('updatedBox'), filenameInput: $('filenameInput'),
    uploadBtn: $('uploadBtn'), fileInput: $('fileInput'), pasteBtn: $('pasteBtn'), diffBtn: $('diffBtn'), commitBtn: $('commitBtn'),
    fontSizeSelectUpdated: $('fontSizeSelectUpdated'), findInputUpdated: $('findInputUpdated'), findBtnUpdated: $('findBtnUpdated'), findResultsUpdated: $('findResultsUpdated'), findPrevUpdated: $('findPrevUpdated'), findNextUpdated: $('findNextUpdated'),
    scrollTopUpdated: $('scrollTopUpdated'),
    commitModal: $('commitModal'), commitClose: $('commitClose'), commitSteps: $('commitSteps'), commitActions: $('commitActions'), commitInfo: $('commitInfo'),
    diffModal: $('diffModal'), diffClose: $('diffClose'), diffOutput: $('diffOutput'), copyDiffBtn: $('copyDiffBtn'),
    previewModal: $('previewModal'), previewClose: $('previewClose'), previewFrame: $('previewFrame'),
    pasteModal: $('pasteModal'), pasteClose: $('pasteClose'), pasteArea: $('pasteArea'), pasteConfirm: $('pasteConfirm'),
    toasts: $('toasts'),
    masterFooter: $('masterFooter')
  };

  // --- Helpers ---
  const headers = () => ({ "Authorization": "token " + GITHUB_TOKEN, "Accept": "application/vnd.github.v3+json" });
  const isSecure = window.isSecureContext;

  function toast(msg, ms=2200, cls=''){
    const div = document.createElement('div');
    div.className = 'toast' + (cls ? ' '+cls : '');
    div.textContent = msg;
    elements.toasts.appendChild(div);
    setTimeout(() => { div.remove(); }, ms);
  }

  function handleError(error, context) {
      console.error(context, error);
      const message = `${context}: ${error.message || 'An unknown error occurred.'}`;
      toast(message, 4500, 'warn');
  }

  function b64EncodeUnicode(str) { return btoa(unescape(encodeURIComponent(str))); }
  function b64DecodeUnicode(b64) { return decodeURIComponent(escape(atob(b64))); }

  function canonicalize(text){
    if(text == null) return '';
    if(text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
    return text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
  }

  // --- GitHub API Functions ---
  async function githubFetch(url, options = {}) {
      const res = await fetch(url, { ...options, headers: headers() });
      if (!res.ok) {
          const errorBody = await res.text();
          throw new Error(`GitHub API Error (${res.status}): ${errorBody}`);
      }
      if (res.status === 204) return null;
      return res.json();
  }

  async function fetchReposForIdentity(identity){
    const collected = new Map();
    const urls = [
        `https://api.github.com/users/${encodeURIComponent(identity)}/repos?per_page=100&type=owner&sort=updated`,
        `https://api.github.com/orgs/${encodeURIComponent(identity)}/repos?per_page=100&type=all&sort=updated`
    ];
    if (identity.toLowerCase() === (localStorage.getItem('github_user') || '').toLowerCase()) {
        urls.push(`https://api.github.com/user/repos?per_page=100&sort=updated`);
    }
    const tasks = urls.map(url =>
        githubFetch(url).then(data => {
            (data || []).forEach(r => {
                if (!collected.has(r.full_name)) collected.set(r.full_name, r);
            });
        }).catch(() => {})
    );
    await Promise.all(tasks);
    return Array.from(collected.values()).sort((a,b)=> new Date(b.updated_at) - new Date(a.updated_at));
  }

  async function fetchRepoInfo(user, repo){
    return githubFetch(`https://api.github.com/repos/${encodeURIComponent(user)}/${encodeURIComponent(repo)}`);
  }

  async function fetchRepoTree(user, repo, branch){
    const data = await githubFetch(`https://api.github.com/repos/${encodeURIComponent(user)}/${encodeURIComponent(repo)}/git/trees/${encodeURIComponent(branch)}?recursive=1`);
    if(!data.tree) throw new Error('Invalid tree response');
    return data.tree.filter(e=>e.type==='blob').map(e=>({path:e.path,sha:e.sha}));
  }

  async function fetchFileContent(user, repo, path, ref){
    const url = `https://api.github.com/repos/${encodeURIComponent(user)}/${encodeURIComponent(repo)}/contents/${encodeURIComponent(path)}${ref?`?ref=${encodeURIComponent(ref)}`:''}`;
    try {
        const data = await githubFetch(url);
        const content = b64DecodeUnicode(data.content);
        return {content, sha:data.sha, path:data.path};
    } catch (error) {
        if (error.message.includes("404")) return null;
        throw error;
    }
  }

  async function putFileContent(user, repo, path, message, newContent, branch, sha){
    const url = `https://api.github.com/repos/${encodeURIComponent(user)}/${encodeURIComponent(repo)}/contents/${encodeURIComponent(path)}`;
    const payload = {message, content:b64EncodeUnicode(newContent), branch};
    if (sha) payload.sha = sha;
    return githubFetch(url, { method:'PUT
